<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
<script>hljs.highlightAll();</script>
<p>
    It was actually Timehop <a href="/notes/64f921f0aee35e86e2ae580119412d2a">that notified me</a>
    about the Instagram API dying. I would not be able to see my photos in their app.
</p>

<p>
    I had set my Instagram to private a couple of years ago and haven't really posted much either.
    My last photo was from 2022. So I'm not really invested in Instagram, per se.
</p>

<p>
    Of course this now changed with my new-found passion of the <a href="https://indieweb.org/">indieweb</a>.
    <br>And so, I set out to create to a script that could read your Instagram archive and converts your posts
    to Kindy posts. <small>(My internal content management system, thingamabob)</small>
</p>

<p>
    Resulting in my own <i>instagram-esque</i> <a href="/photos">Photos page</a>.
</p>

<h2>Programmer troubles</h2>

<p>
    For quick and dirty code, or for your initial Go struct, I like to use this tool called
    <a href="https://mholt.github.io/json-to-go/">JSON-to-Go</a>. Which gave me
    the following monstrosity.
</p>

<pre><code class="language-go">// removed some tabs for readability
type AutoGenerated struct {
Media []struct {
    URI               string `json:"uri"`
    CreationTimestamp int    `json:"creation_timestamp"`
    MediaMetadata     struct {
        PhotoMetadata struct {
            ExifData []struct {
            Latitude         float64 `json:"latitude,omitempty"`
            Longitude        float64 `json:"longitude,omitempty"`
            SceneCaptureType string  `json:"scene_capture_type,omitempty"`
            Software         string  `json:"software,omitempty"`
            DeviceID         string  `json:"device_id,omitempty"`
            DateTimeOriginal string  `json:"date_time_original,omitempty"`
            SourceType       string  `json:"source_type,omitempty"`
            } `json:"exif_data"`
        } `json:"photo_metadata"`
        VideoMetadata struct {
            ExifData []struct {
                Latitude  float64 `json:"latitude,omitempty"`
                Longitude float64 `json:"longitude,omitempty"`
            } `json:"exif_data"`
        } `json:"video_metadata"`
        CameraMetadata struct {
            HasCameraMetadata bool `json:"has_camera_metadata"`
        } `json:"camera_metadata"`
    } `json:"media_metadata"`
    Title           string `json:"title"`
    CrossPostSource struct {
        SourceApp string `json:"source_app"`
    } `json:"cross_post_source"`
    BackupURI string `json:"backup_uri"`
} `json:"media"`
}
</code></pre>

<p>
    It's not great. Specifically the <code>exif_data</code>, which not only lives in either a
    <code>photo_metadata</code> or <code>video_metadata</code>, it's also an array.
    <br>A Go struct can deal with multiple types in the same struct (see Lat/Long vs the other
    metadata), but in the actual <s>Instagram</s> <s>Facebook</s> <i>Meta</i> JSON
    these are separate array entries.
</p>

<p>
    If you thought that was bad, the worst part is the type of encoding. I wonder if this
    comes from <code>Hack/PHP</code>. But my emojis are 4 separate bytes, instead of
    being a multibyte.
    <br>And yes, I did spend 2 hours trying to get it fixed, but gave up.
    <br><small>Truth be told, I only have 150 posts and there's not a lot of emojis,
    I could, and should, have done it by hand...</small>
</p>

<h2>I fought the CSS and it won</h2>

<p>
    Spend another hour getting the grid to play nicely on <a href="/photos">/photos</a>
    as well as having to deal with incomplete data.
    <br>Not every entry has a summary or even a title. So I use their slug/permalink,
    but those are long strings without spaces so it would mess up the layout.
    <br>Then there were tags, some have none, some from my <i>earlier</i> years
    have a üí©-ton because I tried to get publicity on Instagram. Regardless,
    I'm showing 2 and a count of how many, the rest has to be shown on the real page.
</p>

<figure>
    <img src="/kd/images/20241204-photos.png" class="u-photo responsive-img"
         alt="Screenshot of /photos, showing a grid of 3 by 2 photos. Photos are of different height and metadata above them has different amount of lines">
    <figcaption>It's not pretty, but it's honest work. üßë‚Äçüåæ</figcaption>
</figure>

<p>
    But for now there's at least something, and while not pixel-perfect, for a personal
    site I think it's actually quite fitting.
</p>

<p>
    I didn't remember it, but apparently I also had 2 videos.
    So I had to scramble to get that to work as well, and
    <a href="/photos/e6847ba87f4889bd909eadde101ea75d">so it does</a>.
    <small>(Hardcoded to ".mp4", but we'll cross that bridge when we need to)</small>
</p>

<p>
    I have not linked (<code>u-syndication</code>) them back to their Instagram page because
    I could not find the <i>instagram shortcode</i> or how to decode it from whatever JSON I had.
</p>

<p>
    Not to mention that my Instagram is still set to private.. so probably should open it up
    since it's all here in public.. ü§î
</p>